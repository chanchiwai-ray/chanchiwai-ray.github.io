<!DOCTYPE html><html lang="en-us" class="__variable_bc0dcf scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7cba1811e3c25a15-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/ce39e5fd71ac2204.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/2d617ddf3705e99d.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/10e892855c0ee316.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-411553d874472be6.js"/><script src="/_next/static/chunks/4bd1b696-fd566b7ef040c634.js" async=""></script><script src="/_next/static/chunks/517-8f0473015f82d7dc.js" async=""></script><script src="/_next/static/chunks/main-app-156574f202e05fbb.js" async=""></script><script src="/_next/static/chunks/c16f53c3-db36c35b4eab1cc3.js" async=""></script><script src="/_next/static/chunks/173-cdf34a84fb71192b.js" async=""></script><script src="/_next/static/chunks/830-c94ab44a0e17ca4a.js" async=""></script><script src="/_next/static/chunks/app/layout-fed54404a194d21a.js" async=""></script><script src="/_next/static/chunks/970-9f18edc3a6e123c8.js" async=""></script><script src="/_next/static/chunks/app/blog/%5B...slug%5D/page-9b88551e61e607f4.js" async=""></script><link rel="preload" href="https://analytics.umami.is/script.js" as="script"/><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=" as="script"/><meta name="next-size-adjust" content=""/><link rel="icon" type="image/png" sizes="64x64" href="/static/favicons/favicon-64x64.png"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><title>Setting Up Kubernetes Cluster with Canonical Kubernetes | Ray&#x27;s Blog</title><meta name="description" content="There many ways to set up Kubernetes cluster for learning purpose, such as minikube or MicroK8s. In this post, I would like to introduce yet another way to deploy Kubernetes cluster with Canoincal K8s."/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://chanchiwai-ray.github.io/blog/k8s/deploy-charmed-kubernetes"/><link rel="alternate" type="application/rss+xml" href="https://chanchiwai-ray.github.io/feed.xml"/><meta property="og:title" content="Setting Up Kubernetes Cluster with Canonical Kubernetes"/><meta property="og:description" content="There many ways to set up Kubernetes cluster for learning purpose, such as minikube or MicroK8s. In this post, I would like to introduce yet another way to deploy Kubernetes cluster with Canoincal K8s."/><meta property="og:url" content="https://chanchiwai-ray.github.io/blog/k8s/deploy-charmed-kubernetes"/><meta property="og:site_name" content="Ray&#x27;s Blog"/><meta property="og:locale" content="en_US"/><meta property="og:image" content="https://chanchiwai-ray.github.io/static/images/x-card.png"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-03-30T00:00:00.000Z"/><meta property="article:modified_time" content="2025-03-30T00:00:00.000Z"/><meta property="article:author" content="Chi Wai CHAN"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Setting Up Kubernetes Cluster with Canonical Kubernetes"/><meta name="twitter:description" content="There many ways to set up Kubernetes cluster for learning purpose, such as minikube or MicroK8s. In this post, I would like to introduce yet another way to deploy Kubernetes cluster with Canoincal K8s."/><meta name="twitter:image" content="https://chanchiwai-ray.github.io/static/images/x-card.png"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="bg-white pl-[calc(100vw-100%)] text-black antialiased dark:bg-gray-950 dark:text-white"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><header class="flex items-center w-full bg-white dark:bg-gray-950 justify-between py-10 sticky top-0 z-50"><a class="break-words" aria-label="Ray&#x27;s Blog" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">Ray&#x27;s Blog</div></div></a><div class="flex items-center space-x-4 leading-5 sm:space-x-6"><div class="no-scrollbar hidden max-w-40 items-center space-x-4 overflow-x-auto pr-2 sm:flex sm:space-x-6 md:max-w-72 lg:max-w-96"><a class="m-1 block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400" href="/blog">Blog</a><a class="m-1 block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400" href="/tags">Tags</a><a class="m-1 block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400" href="/projects">Projects</a><a class="m-1 block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400" href="/about">About</a></div><button aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></button><div class="mr-5 flex items-center"><div class="relative inline-block text-left" data-headlessui-state=""><div class="flex items-center justify-center hover:text-primary-500 dark:hover:text-primary-400"><button aria-label="Theme switcher" id="headlessui-menu-button-:Resqddb:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><svg class="h-6 w-6"></svg></button></div></div></div><button aria-label="Toggle Menu" class="sm:hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-8 w-8 text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><span hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></span></div></header><main class="mb-auto"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Setting Up Kubernetes Cluster with Canonical Kubernetes","datePublished":"2025-03-30T00:00:00.000Z","dateModified":"2025-03-30T00:00:00.000Z","description":"There many ways to set up Kubernetes cluster for learning purpose, such as minikube or MicroK8s. In this post, I would like to introduce yet another way to deploy Kubernetes cluster with Canoincal K8s.","image":"/static/images/x-card.png","url":"https://chanchiwai-ray.github.io/blog/k8s/deploy-charmed-kubernetes","author":[{"@type":"Person","name":"Chi Wai CHAN"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed bottom-8 right-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-03-30T00:00:00.000Z">Sunday, March 30, 2025</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Setting Up Kubernetes Cluster with Canonical Kubernetes</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0"><dl class="pb-10 pt-6 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img alt="avatar" loading="lazy" width="38" height="38" decoding="async" data-nimg="1" class="h-10 w-10 rounded-full" style="color:transparent" src="/static/images/avatar.png"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Chi Wai CHAN</dd><dt class="sr-only">Linkedin and GitHub</dt><dd><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/chi-wai-chan-ba5870137">@Linkedin</a> ‚Ä¢ <a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" target="_blank" rel="noopener noreferrer" href="https://github.com/chanchiwai-ray">@Github</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pb-8 pt-10 dark:prose-invert"><h2 class="content-header" id="-introduction"><a class="break-words" href="#-introduction" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg viewBox="0 0 20 20" class="h-5 linkicon w-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>üåü Introduction</h2><p>Distributions like minikube and MicroK8s are great for setting up a local Kubernetes for testing and learning. If you need anything more than a testing environment (maybe a cluster for your homelab or a cluster for your small business), these option may not be great. <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://ubuntu.com/kubernetes">Canonical Kubernetes</a> is another distribution which can be used to deploy multi-node Kubernetes cluster on premise or on the cloud, and it offers many <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://documentation.ubuntu.com/canonical-kubernetes/latest/charm/howto/#how-to-guides">integrations</a> with other solutions such as OpenStack and Ceph.</p><p>In this post, I am going to show you how to set up a three nodes Kubernetes cluster on you local desktop or laptop for <strong>testing or learning</strong> purpose. The tutorial uses <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://documentation.ubuntu.com/lxd/en/latest/">LXD</a> as the cloud substrate for the nodes, but you can also use other <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://documentation.ubuntu.com/juju/latest/user/reference/cloud/">cloud substrates</a> as well.</p><div class="markdown-alert markdown-alert-warning" dir="auto"><p class="markdown-alert-title" dir="auto"><svg viewBox="0 0 16 16" aria-hidden="true" class="octicon" height="16" width="16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>WARNING</p><p>Do not use it for production! This is not a tutorial for setting up a production grade Kubernetes cluster!</p></div><ul class=""><li class=""><a href="#-introduction">üåü Introduction</a></li><li class=""><a href="#-prerequisite">ü™® Prerequisite</a></li><li class=""><a href="#-getting-started">üöÄ Getting Started</a><ul class=""><li class=""><a href="#-terraform-plan">üìë Terraform plan</a></li><li class=""><a href="#-put-it-all-together">ü§ù Put it all together</a></li><li class=""><a href="#-deploy-kubernetes-cluster">üíª Deploy Kubernetes cluster</a></li><li class=""><a href="#-manage-the-kubernetes-cluster">üßô Manage the Kubernetes cluster</a></li><li class=""><a href="#-check-the-status-of-kubernetes-cluster">üí° Check the status of Kubernetes cluster</a></li></ul></li><li class=""><a href="#-clean-up-resources">üßπ Clean up resources</a></li></ul><h2 class="content-header" id="-prerequisite"><a class="break-words" href="#-prerequisite" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg viewBox="0 0 20 20" class="h-5 linkicon w-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>ü™® Prerequisite</h2><p>Before you continue with the tutorial, please make sure that you have met the following software or hardware requirements. You can follow the link to install and initialize the software required for this tutorial.</p><ul><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="https://documentation.ubuntu.com/lxd/en/latest/">LXD</a></li><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="https://juju.is/">Juju</a></li><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="https://www.terraform.io/">Terraform</a></li><li>About 6 CPUs (not a strict requirements)</li><li>About 12 GiB of RAMs (not a strict requirements)</li><li>About 100 GiB of storage (not a strict requirements)</li></ul><p>These are not a hard requirements. Depending on the workloads, you should still be able to complete the deployment with a less powerful machine.</p><div class="markdown-alert markdown-alert-note" dir="auto"><p class="markdown-alert-title" dir="auto"><svg viewBox="0 0 16 16" aria-hidden="true" class="octicon" height="16" width="16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>NOTE</p><p>The reason for using Juju and Terraform is for reproducibility. As a testing environment, you may change you setup frequently. Using terraform allows you to easily re-deploy the same environment with all the necessary addons.</p></div><h2 class="content-header" id="-getting-started"><a class="break-words" href="#-getting-started" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg viewBox="0 0 20 20" class="h-5 linkicon w-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>üöÄ Getting Started</h2><div class="markdown-alert markdown-alert-tip" dir="auto"><p class="markdown-alert-title" dir="auto"><svg viewBox="0 0 16 16" aria-hidden="true" class="octicon" height="16" width="16"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>TIP</p><p>If you simply want to try out the Kubernetes cluster, you can go to my infrastructure repository: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/chanchiwai-ray/infrastructure/tree/main/deployments/testing-ha/k8s-juju-lxd">https://github.com/chanchiwai-ray/infrastructure/tree/main/deployments/testing-ha/k8s-juju-lxd</a>.</p></div><p>We will be using the <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://registry.terraform.io/providers/juju/juju/latest/docs">Terraform Juju provider</a> to deploy three nodes Kubernetes cluster at version 1.32. One of the served as both worker and control plane node, the remaining two will be the worker nodes. The spec of virtual machines are listed below:</p><ul><li>k8s/0<ul><li>2 vCPUs</li><li>4 GiB of RAMs</li><li>1 root disk of 20 GiB</li></ul></li><li>k8s-worker/0<ul><li>2 vCPUs</li><li>4 GiB of RAMs</li><li>1 root disk of 40 GiB</li></ul></li><li>k8s-worker/1<ul><li>2 vCPUs</li><li>4 GiB of RAMs</li><li>1 root disk of 40 GiB</li></ul></li></ul><h3 class="content-header" id="-terraform-plan"><a class="break-words" href="#-terraform-plan" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg viewBox="0 0 20 20" class="h-5 linkicon w-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>üìë Terraform plan</h3><p>The first thing in the terraform plan is the <code>terraform</code> block. We will specify the provider as Terraform Juju provider. Then, we need to create a <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://documentation.ubuntu.com/juju/latest/user/reference/model/">Juju model</a> called <code>k8s</code> on the cloud <code>localhost</code> in <code>localhost</code> region.</p><div class="relative"><pre><code class="code-highlight language-terraform"><span class="code-line"># main.tf
</span><span class="code-line">
</span><span class="code-line"># Use Terraform Juju provider
</span><span class="code-line">terraform {
</span><span class="code-line">  required_providers {
</span><span class="code-line">    juju = {
</span><span class="code-line">      version = &quot;~&gt; 0.17.0&quot;
</span><span class="code-line">      source  = &quot;juju/juju&quot;
</span><span class="code-line">    }
</span><span class="code-line">  }
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line"># Create a Juju model
</span><span class="code-line">resource &quot;juju_model&quot; &quot;k8s_model&quot; {
</span><span class="code-line">  name = &quot;k8s&quot;
</span><span class="code-line">
</span><span class="code-line">  # In my case, they are both `localhost`.
</span><span class="code-line">  # You can check yours using `juju clouds` and `juju regions`.
</span><span class="code-line">  cloud {
</span><span class="code-line">    name   = &quot;localhost&quot;
</span><span class="code-line">    region = &quot;localhost&quot;
</span><span class="code-line">  }
</span><span class="code-line">}
</span></code></pre></div><hr/><p>Next, we will create one unit of the control plane node (also used as a worker, but you disabled it using <code>kubectl</code> later if required).</p><div class="relative"><pre><code class="code-highlight language-terraform"><span class="code-line"># main.tf
</span><span class="code-line">
</span><span class="code-line"># ... some content from previous steps
</span><span class="code-line">
</span><span class="code-line">module &quot;k8s&quot; {
</span><span class="code-line">  source = &quot;git::https://github.com/canonical/k8s-operator//charms/worker/k8s/terraform?ref=main&quot;
</span><span class="code-line">
</span><span class="code-line">  units = 1 # one control plane node
</span><span class="code-line">  model = juju_model.k8s_model.name
</span><span class="code-line">
</span><span class="code-line">  base        = &quot;ubuntu@24.04&quot;
</span><span class="code-line">  channel     = &quot;1.32/stable&quot;
</span><span class="code-line">  constraints = &quot;arch=amd64 cores=2 mem=4096M root-disk=20480M virt-type=virtual-machine&quot;
</span><span class="code-line">
</span><span class="code-line">  config = {
</span><span class="code-line">    load-balancer-enabled = true                        # enable load balancer feature
</span><span class="code-line">    load-balancer-cidrs   = &quot;10.42.75.200-10.42.75.200&quot; # load balancer cidrs (placeholder, need update)
</span><span class="code-line">    ingress-enabled       = true                        # enable ingress feature
</span><span class="code-line">    local-storage-enabled = true                        # enable local hostpath storage
</span><span class="code-line">  }
</span><span class="code-line">}
</span></code></pre></div><p>Here, I am using a module from the upstream to simplify the terraform plan a little bit. For the module options, I set the version of Kubernetes to <code>1.32</code> and specify the constraints for the unit as <code>arch=amd64 cores=2 mem=4096M root-disk=20480M virt-type=virtual-machine</code>. If you want to use a different version of Kubernetes, or want to use less resources, you can adjust those values. However, note that the constraint for <code>virt-type=virtual-machine</code> is <strong>required</strong>, since the CNI used in Canonical Kubernetes (Cilium) cannot run inside unprivileged containers.</p><p>If you are deploying a Kubernetes cluster for learning, it&#x27;s general nice to have some built-in features such ingress controller and storage class configured. So, in the <code>config</code> block, I enable the load-balancer, ingress, and local storage features.</p><hr/><p>Next, we will add two units of the worker nodes.</p><div class="relative"><pre><code class="code-highlight language-terraform"><span class="code-line"># main.tf
</span><span class="code-line">
</span><span class="code-line"># ... some content from previous steps
</span><span class="code-line">
</span><span class="code-line">module &quot;k8s_worker&quot; {
</span><span class="code-line">  source = &quot;git::https://github.com/canonical/k8s-operator//charms/worker/terraform?ref=main&quot;
</span><span class="code-line">
</span><span class="code-line">  units = 2 # two worker nodes
</span><span class="code-line">  model = juju_model.k8s_model.name
</span><span class="code-line">
</span><span class="code-line">  base        = &quot;ubuntu@24.04&quot;
</span><span class="code-line">  channel     = &quot;1.32/stable&quot;
</span><span class="code-line">  constraints = &quot;arch=amd64 cores=2 mem=4096M root-disk=40960M virt-type=virtual-machine&quot;
</span><span class="code-line">
</span><span class="code-line">  config = {}
</span><span class="code-line">}
</span></code></pre></div><p>Here, the module options are pretty much the same as the control plane node, just a bit more storage <code>root-disk=40960M</code> and no extra configuration for the worker nodes.</p><hr/><p>Finally, the control plane node and the worker nodes need to form a cluster. To do that, we can use the <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://documentation.ubuntu.com/juju/latest/user/reference/relation/">Juju integration</a>, and it&#x27;s a resource in Terraform Juju provider.</p><div class="relative"><pre><code class="code-highlight language-terraform"><span class="code-line"># main.tf
</span><span class="code-line">
</span><span class="code-line"># ... some content from previous steps
</span><span class="code-line">
</span><span class="code-line">resource &quot;juju_integration&quot; &quot;k8s_to_k8s_worker&quot; {
</span><span class="code-line">  model = juju_model.k8s_model.name
</span><span class="code-line">
</span><span class="code-line">  application {
</span><span class="code-line">    name     = module.k8s.app_name
</span><span class="code-line">    endpoint = &quot;k8s-cluster&quot;
</span><span class="code-line">  }
</span><span class="code-line">
</span><span class="code-line">  application {
</span><span class="code-line">    name     = module.k8s_worker.app_name
</span><span class="code-line">    endpoint = &quot;cluster&quot;
</span><span class="code-line">  }
</span><span class="code-line">}
</span></code></pre></div><p>The Juju integration basically are some Python codes that handles the forming (or destruction) of Kubernetes cluster.</p><h3 class="content-header" id="-put-it-all-together"><a class="break-words" href="#-put-it-all-together" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg viewBox="0 0 20 20" class="h-5 linkicon w-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>ü§ù Put it all together</h3><p>Below is the entire terraform plan for deploying three nodes Kubernetes cluster:</p><div class="relative"><pre><code class="code-highlight language-terraform"><span class="code-line"># main.tf
</span><span class="code-line">
</span><span class="code-line"># Use Terraform Juju provider
</span><span class="code-line">terraform {
</span><span class="code-line">  required_providers {
</span><span class="code-line">    juju = {
</span><span class="code-line">      version = &quot;~&gt; 0.17.0&quot;
</span><span class="code-line">      source  = &quot;juju/juju&quot;
</span><span class="code-line">    }
</span><span class="code-line">  }
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line"># Create a Juju model
</span><span class="code-line">resource &quot;juju_model&quot; &quot;k8s_model&quot; {
</span><span class="code-line">  name = &quot;k8s&quot;
</span><span class="code-line">
</span><span class="code-line">  # In my case, they are both `localhost`.
</span><span class="code-line">  # You can check yours using `juju clouds` and `juju regions`.
</span><span class="code-line">  cloud {
</span><span class="code-line">    name   = &quot;localhost&quot;
</span><span class="code-line">    region = &quot;localhost&quot;
</span><span class="code-line">  }
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line">module &quot;k8s&quot; {
</span><span class="code-line">  source = &quot;git::https://github.com/canonical/k8s-operator//charms/worker/k8s/terraform?ref=main&quot;
</span><span class="code-line">
</span><span class="code-line">  units = 1 # one control plane node
</span><span class="code-line">  model = juju_model.k8s_model.name
</span><span class="code-line">
</span><span class="code-line">  base        = &quot;ubuntu@24.04&quot;
</span><span class="code-line">  channel     = &quot;1.32/stable&quot;
</span><span class="code-line">  constraints = &quot;arch=amd64 cores=2 mem=4096M root-disk=20480M virt-type=virtual-machine&quot;
</span><span class="code-line">
</span><span class="code-line">  config = {
</span><span class="code-line">    load-balancer-enabled = true                        # enable load balancer feature
</span><span class="code-line">    load-balancer-cidrs   = &quot;10.42.75.200-10.42.75.200&quot; # load balancer cidrs (placeholder, need update)
</span><span class="code-line">    ingress-enabled       = true                        # enable ingress feature
</span><span class="code-line">    local-storage-enabled = true                        # enable local hostpath storage
</span><span class="code-line">  }
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line">module &quot;k8s_worker&quot; {
</span><span class="code-line">  source = &quot;git::https://github.com/canonical/k8s-operator//charms/worker/terraform?ref=main&quot;
</span><span class="code-line">
</span><span class="code-line">  units = 2 # two worker nodes
</span><span class="code-line">  model = juju_model.k8s_model.name
</span><span class="code-line">
</span><span class="code-line">  base        = &quot;ubuntu@24.04&quot;
</span><span class="code-line">  channel     = &quot;1.32/stable&quot;
</span><span class="code-line">  constraints = &quot;arch=amd64 cores=2 mem=4096M root-disk=40960M virt-type=virtual-machine&quot;
</span><span class="code-line">
</span><span class="code-line">  config = {}
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line">resource &quot;juju_integration&quot; &quot;k8s_to_k8s_worker&quot; {
</span><span class="code-line">  model = juju_model.k8s_model.name
</span><span class="code-line">
</span><span class="code-line">  application {
</span><span class="code-line">    name     = module.k8s.app_name
</span><span class="code-line">    endpoint = &quot;k8s-cluster&quot;
</span><span class="code-line">  }
</span><span class="code-line">
</span><span class="code-line">  application {
</span><span class="code-line">    name     = module.k8s_worker.app_name
</span><span class="code-line">    endpoint = &quot;cluster&quot;
</span><span class="code-line">  }
</span><span class="code-line">}
</span></code></pre></div><h3 class="content-header" id="-deploy-kubernetes-cluster"><a class="break-words" href="#-deploy-kubernetes-cluster" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg viewBox="0 0 20 20" class="h-5 linkicon w-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>üíª Deploy Kubernetes cluster</h3><p>In the directory with the terraform plan, and run the following commands:</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">terraform init
</span><span class="code-line">terraform plan
</span><span class="code-line">terraform apply
</span></code></pre></div><p>This will deploy the kubernetes cluster in the background. To monitor the deployment progress, run</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">juju status <span class="token variable parameter">--watch</span> 5s
</span></code></pre></div><p>When the deployment is completed, you should see something like this</p><div class="relative"><pre><code class="code-highlight language-text"><span class="code-line">Model  Controller  Cloud/Region         Version  SLA          Timestamp
</span><span class="code-line">k8s    overlord    localhost/localhost  3.6.3    unsupported  14:35:30+08:00
</span><span class="code-line">
</span><span class="code-line">App         Version  Status  Scale  Charm       Channel      Rev  Exposed  Message
</span><span class="code-line">k8s         1.32.2   active      1  k8s         1.32/stable  458  yes      Ready
</span><span class="code-line">k8s-worker  1.32.2   active      2  k8s-worker  1.32/stable  456  no       Ready
</span><span class="code-line">
</span><span class="code-line">Unit           Workload  Agent  Machine  Public address  Ports     Message
</span><span class="code-line">k8s-worker/0*  active    idle   0        10.42.75.176              Ready
</span><span class="code-line">k8s-worker/1   active    idle   1        10.42.75.227              Ready
</span><span class="code-line">k8s/0*         active    idle   2        10.42.75.196    6443/tcp  Ready
</span><span class="code-line">
</span><span class="code-line">Machine  State    Address       Inst id        Base          AZ  Message
</span><span class="code-line">0        started  10.42.75.176  juju-da35cc-0  ubuntu@24.04      Running
</span><span class="code-line">1        started  10.42.75.227  juju-da35cc-1  ubuntu@24.04      Running
</span><span class="code-line">2        started  10.42.75.196  juju-da35cc-2  ubuntu@24.04      Running
</span></code></pre></div><p>I mentioned earlier that the <code>load-balancer-cidrs</code> config option was just a placeholder. Now, we will update it the IP addresses of these nodes (because we don&#x27;t have external load balancer so we will just use these nodes as &quot;external&quot; load balancer).</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">juju config k8s load-balancer-cidrs<span class="token operator">=</span><span class="token string">&quot;10.42.75.176/32 10.42.75.227/32 10.42.75.196/32&quot;</span>
</span></code></pre></div><p>One of the IP will be used by Cilium to create a <code>cilium-ingress</code> service of <code>LoadBalancer</code> type (remember we enabled ingress feature), so you will only have two IPs for service of <code>LoadBalancer</code> type.</p><p>For more information about ingress and load balancer in Canonical Kubernetes, see the <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://documentation.ubuntu.com/canonical-kubernetes/latest/charm/explanation/">documentation</a>.</p><h3 class="content-header" id="-manage-the-kubernetes-cluster"><a class="break-words" href="#-manage-the-kubernetes-cluster" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg viewBox="0 0 20 20" class="h-5 linkicon w-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>üßô Manage the Kubernetes cluster</h3><p>To retrieve the kube config, run</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token function">mkdir</span> <span class="token variable parameter">-p</span> <span class="token constant environment">$HOME</span>/.kube/config
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable parameter">-e</span> <span class="token constant environment">$HOME</span>/.kube/config <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">    <span class="token function">mv</span> <span class="token constant environment">$HOME</span>/.kube/config <span class="token constant environment">$HOME</span>/.kube/config.backup.<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span>
</span><span class="code-line"><span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line">juju run k8s/0 get-kubeconfig <span class="token operator">|</span> yq <span class="token variable parameter">-r</span> <span class="token string">&#x27;.kubeconfig&#x27;</span> <span class="token operator">&gt;&gt;</span> <span class="token constant environment">$HOME</span>/.kube/config
</span></code></pre></div><p>. The <code>get-kubeconfig</code> is an <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://documentation.ubuntu.com/juju/latest/user/reference/action/">Juju action</a> defined in the k8s operator that returns the kube config in yaml format. We need to extract the <code>kubeconfig</code> key from the result, and place it in <code>$HOME/.kube/config</code>. In case you previously have the kube config, you can also back it up <code>mv $HOME/.kube/config $HOME/.kube/config.backup.$(date +%F)</code>.</p><p>You can then use <code>kubectl</code> to manage the Kubernetes cluster. If you are on Ubuntu, you can use the <code>kubectl</code> snap.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token function">sudo</span> snap <span class="token function">install</span> kubectl <span class="token variable parameter">--classic</span>
</span></code></pre></div><p>Alternatively, you can install <code>kubectl</code> following the <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://kubernetes.io/docs/tasks/tools/">official documentation</a>.</p><h3 class="content-header" id="-check-the-status-of-kubernetes-cluster"><a class="break-words" href="#-check-the-status-of-kubernetes-cluster" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg viewBox="0 0 20 20" class="h-5 linkicon w-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>üí° Check the status of Kubernetes cluster</h3><p>Finally, let&#x27;s check what is in the Kubernetes cluster.</p><p><strong>Nodes</strong></p><div class="relative"><pre><code class="code-highlight language-text"><span class="code-line">$ kubectl get nodes
</span><span class="code-line">NAME            STATUS   ROLES                  AGE   VERSION
</span><span class="code-line">juju-da35cc-0   Ready    worker                 36m   v1.32.2
</span><span class="code-line">juju-da35cc-1   Ready    worker                 35m   v1.32.2
</span><span class="code-line">juju-da35cc-2   Ready    control-plane,worker   36m   v1.32.2
</span></code></pre></div><p><strong>Kube System</strong></p><div class="relative"><pre><code class="code-highlight language-text"><span class="code-line">$ kubectl get -n kube-system all
</span><span class="code-line">NAME                                      READY   STATUS    RESTARTS      AGE
</span><span class="code-line">pod/cilium-58b8b                          1/1     Running   0             3h54m
</span><span class="code-line">pod/cilium-d77pw                          1/1     Running   0             123m
</span><span class="code-line">pod/cilium-gvs2f                          1/1     Running   0             123m
</span><span class="code-line">pod/cilium-operator-85f5f9954b-82n7g      1/1     Running   1 (18m ago)   123m
</span><span class="code-line">pod/ck-storage-rawfile-csi-controller-0   2/2     Running   0             3h55m
</span><span class="code-line">pod/ck-storage-rawfile-csi-node-lptc2     4/4     Running   0             3h55m
</span><span class="code-line">pod/ck-storage-rawfile-csi-node-rhshh     4/4     Running   0             3h55m
</span><span class="code-line">pod/ck-storage-rawfile-csi-node-sf5b7     4/4     Running   0             3h55m
</span><span class="code-line">pod/coredns-56d5ddcf86-lklvw              1/1     Running   0             3h55m
</span><span class="code-line">pod/metrics-server-8694c96fb7-87fbm       1/1     Running   0             3h55m
</span><span class="code-line">
</span><span class="code-line">NAME                                        TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)                      AGE
</span><span class="code-line">service/cilium-ingress                      LoadBalancer   10.152.183.250   10.42.75.176   80:30953/TCP,443:30265/TCP   123m
</span><span class="code-line">service/ck-storage-rawfile-csi-controller   ClusterIP      None             &lt;none&gt;         &lt;none&gt;                       3h55m
</span><span class="code-line">service/ck-storage-rawfile-csi-node         ClusterIP      10.152.183.254   &lt;none&gt;         9100/TCP                     3h55m
</span><span class="code-line">service/coredns                             ClusterIP      10.152.183.177   &lt;none&gt;         53/UDP,53/TCP                3h55m
</span><span class="code-line">service/hubble-peer                         ClusterIP      10.152.183.193   &lt;none&gt;         443/TCP                      3h55m
</span><span class="code-line">service/metrics-server                      ClusterIP      10.152.183.219   &lt;none&gt;         443/TCP                      3h55m
</span><span class="code-line">
</span><span class="code-line">NAME                                         DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
</span><span class="code-line">daemonset.apps/cilium                        3         3         3       3            3           kubernetes.io/os=linux   3h55m
</span><span class="code-line">daemonset.apps/ck-storage-rawfile-csi-node   3         3         3       3            3           &lt;none&gt;                   3h55m
</span><span class="code-line">
</span><span class="code-line">NAME                              READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class="code-line">deployment.apps/cilium-operator   1/1     1            1           3h55m
</span><span class="code-line">deployment.apps/coredns           1/1     1            1           3h55m
</span><span class="code-line">deployment.apps/metrics-server    1/1     1            1           3h55m
</span><span class="code-line">
</span><span class="code-line">NAME                                         DESIRED   CURRENT   READY   AGE
</span><span class="code-line">replicaset.apps/cilium-operator-6978488575   0         0         0       3h55m
</span><span class="code-line">replicaset.apps/cilium-operator-7c47596f76   0         0         0       3h54m
</span><span class="code-line">replicaset.apps/cilium-operator-85f5f9954b   1         1         1       123m
</span><span class="code-line">replicaset.apps/cilium-operator-85fb4b9ddf   0         0         0       3h55m
</span><span class="code-line">replicaset.apps/coredns-56d5ddcf86           1         1         1       3h55m
</span><span class="code-line">replicaset.apps/metrics-server-8694c96fb7    1         1         1       3h55m
</span><span class="code-line">
</span><span class="code-line">NAME                                                 READY   AGE
</span><span class="code-line">statefulset.apps/ck-storage-rawfile-csi-controller   1/1     3h55m
</span></code></pre></div><p>There are ingress, local rawfile storage, and load balancer features because we enabled them during the deploymentbecause we enabled them during the deployment.</p><h2 class="content-header" id="-clean-up-resources"><a class="break-words" href="#-clean-up-resources" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg viewBox="0 0 20 20" class="h-5 linkicon w-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>üßπ Clean up resources</h2><p>When you are done with the testing, run</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">terraform apply <span class="token variable parameter">-destroy</span>
</span></code></pre></div><p>to clean up the resources.</p><hr/><p>üöÄ That&#x27;s all for now! Hope you enjoy learning Kubernetes!</p></div><div class="pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300"><a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/chanchiwai-ray/chanchiwai-ray.github.io/blob/main/data/blog/k8s/deploy-charmed-kubernetes.mdx">View on GitHub</a></div><div class="pb-6 pt-6 text-center text-gray-700 dark:text-gray-300" id="comment"><button>Load Comments</button></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/juju">juju</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/lxd">lxd</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/terraform">terraform</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a class="break-words" href="/blog/ceph/deploy-three-nodes-microceph">Setting Up Ceph Cluster with MicroCeph</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Back to the blog" href="/blog">‚Üê Back to the blog</a></div></footer></div></div></article></section></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a href="mailto:chanchiwairay@gmail.com" target="_blank" rel="noopener noreferrer" class="text-sm text-gray-500 transition hover:text-gray-600"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-8 w-8"><title>Mail</title><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg></a><a href="https://github.com/chanchiwai-ray" target="_blank" rel="noopener noreferrer" class="text-sm text-gray-500 transition hover:text-gray-600"><span class="sr-only">github</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-8 w-8"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a href="https://www.linkedin.com/in/chi-wai-chan-ba5870137" target="_blank" rel="noopener noreferrer" class="text-sm text-gray-500 transition hover:text-gray-600"><span class="sr-only">linkedin</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-8 w-8"><title>Linkedin</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Chi Wai CHAN</div><div> ‚Ä¢ </div><div>¬© 2025</div><div> ‚Ä¢ </div><a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/chanchiwai-ray/chanchiwai-ray.github.io/issues">Report Issues</a></div></div></footer></section><script src="/_next/static/chunks/webpack-411553d874472be6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[3894,[\"545\",\"static/chunks/c16f53c3-db36c35b4eab1cc3.js\",\"173\",\"static/chunks/173-cdf34a84fb71192b.js\",\"830\",\"static/chunks/830-c94ab44a0e17ca4a.js\",\"177\",\"static/chunks/app/layout-fed54404a194d21a.js\"],\"ThemeProviders\"]\n3:I[3704,[\"545\",\"static/chunks/c16f53c3-db36c35b4eab1cc3.js\",\"173\",\"static/chunks/173-cdf34a84fb71192b.js\",\"830\",\"static/chunks/830-c94ab44a0e17ca4a.js\",\"177\",\"static/chunks/app/layout-fed54404a194d21a.js\"],\"\"]\n4:I[7969,[\"545\",\"static/chunks/c16f53c3-db36c35b4eab1cc3.js\",\"173\",\"static/chunks/173-cdf34a84fb71192b.js\",\"830\",\"static/chunks/830-c94ab44a0e17ca4a.js\",\"177\",\"static/chunks/app/layout-fed54404a194d21a.js\"],\"KBarSearchProvider\"]\n5:I[8173,[\"173\",\"static/chunks/173-cdf34a84fb71192b.js\",\"970\",\"static/chunks/970-9f18edc3a6e123c8.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-9b88551e61e607f4.js\"],\"\"]\n6:I[2076,[\"545\",\"static/chunks/c16f53c3-db36c35b4eab1cc3.js\",\"173\",\"static/chunks/173-cdf34a84fb71192b.js\",\"830\",\"static/chunks/830-c94ab44a0e17ca4a.js\",\"177\",\"static/chunks/app/layout-fed54404a194d21a.js\"],\"KBarButton\"]\n7:I[4984,[\"545\",\"static/chunks/c16f53c3-db36c35b4eab1cc3.js\",\"173\",\"static/chunks/173-cdf34a84fb71192b.js\",\"830\",\"static/chunks/830-c94ab44a0e17ca4a.js\",\"177\",\"static/chunks/app/layout-fed54404a194d21a.js\"],\"default\"]\n8:I[1861,[\"545\",\"static/chunks/c16f53c3-db36c35b4eab1cc3.js\",\"173\",\"static/chunks/173-cdf34a84fb71192b.js\",\"830\",\"static/chunks/830-c94ab44a0e17ca4a.js\",\"177\",\"static/chunks/app/layout-fed54404a194d21a.js\"],\"default\"]\n9:I[5244,[],\"\"]\na:I[3866,[],\"\"]\nc:I[6213,[],\"OutletBoundary\"]\ne:I[6213,[],\"MetadataBoundary\"]\n10:I[6213,[],\"ViewportBoundary\"]\n12:I[4835,[],\"\"]\n:HL[\"/_next/static/media/7cba1811e3c25a15-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/ce39e5fd71ac2204.css\",\"style\"]\n:HL[\"/_next/static/css/2d617ddf3705e99d.css\",\"style\"]\n:HL[\"/_next/static/css/10e892855c0ee316.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"Md9PJ-ar4ZjF_xC8fwDT8\",\"p\":\"\",\"c\":[\"\",\"blog\",\"k8s\",\"deploy-charmed-kubernetes\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"k8s/deploy-charmed-kubernetes\",\"c\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/ce39e5fd71ac2204.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2d617ddf3705e99d.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_bc0dcf scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"64x64\",\"href\":\"/static/favicons/favicon-64x64.png\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"body\",null,{\"className\":\"bg-white pl-[calc(100vw-100%)] text-black antialiased dark:bg-gray-950 dark:text-white\",\"children\":[\"$\",\"$L2\",null,{\"children\":[[[[\"$\",\"$L3\",null,{\"strategy\":\"lazyOnload\",\"data-domain\":\"\",\"data-api\":\"$undefined\",\"src\":\"\"}],[\"$\",\"$L3\",null,{\"strategy\":\"lazyOnload\",\"id\":\"plausible-script\",\"children\":\"\\n            window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }\\n        \"}]],[[\"$\",\"$L3\",null,{\"strategy\":\"lazyOnload\",\"id\":\"sa-script\",\"children\":\"\\n            window.sa_event=window.sa_event||function(){var a=[].slice.call(arguments);window.sa_event.q?window.sa_event.q.push(a):window.sa_event.q=[a]};\\n        \"}],[\"$\",\"$L3\",null,{\"strategy\":\"lazyOnload\",\"src\":\"https://scripts.simpleanalyticscdn.com/latest.js\"}]],[\"$\",\"$L3\",null,{\"strategy\":\"lazyOnload\",\"id\":\"posthog-script\",\"children\":\"\\n          !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(\\\".\\\");2==o.length\u0026\u0026(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement(\\\"script\\\")).type=\\\"text/javascript\\\",p.async=!0,p.src=s.api_host+\\\"/static/array.js\\\",(r=t.getElementsByTagName(\\\"script\\\")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a=\\\"posthog\\\",u.people=u.people||[],u.toString=function(t){var e=\\\"posthog\\\";return\\\"posthog\\\"!==a\u0026\u0026(e+=\\\".\\\"+a),t||(e+=\\\" (stub)\\\"),e},u.people.toString=function(){return u.toString(1)+\\\".people (stub)\\\"},o=\\\"capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags\\\".split(\\\" \\\"),n=0;n\u003co.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);\\n          posthog.init('',{api_host:'https://app.posthog.com'})\\n      \"}],[\"$\",\"$L3\",null,{\"async\":true,\"defer\":true,\"src\":\"https://analytics.umami.is/script.js\"}],[[\"$\",\"$L3\",null,{\"strategy\":\"afterInteractive\",\"src\":\"https://www.googletagmanager.com/gtag/js?id=\"}],[\"$\",\"$L3\",null,{\"strategy\":\"afterInteractive\",\"id\":\"ga-script\",\"children\":\"\\n            window.dataLayer = window.dataLayer || [];\\n            function gtag(){dataLayer.push(arguments);}\\n            gtag('js', new Date());\\n            gtag('config', '');\\n        \"}]],\"$undefined\"],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L4\",null,{\"kbarConfig\":{\"searchDocumentsPath\":\"/search.json\"},\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center w-full bg-white dark:bg-gray-950 justify-between py-10 sticky top-0 z-50\",\"children\":[[\"$\",\"$L5\",null,{\"className\":\"break-words\",\"href\":\"/\",\"aria-label\":\"Ray's Blog\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between\",\"children\":[\"$\",\"div\",null,{\"className\":\"hidden h-6 text-2xl font-semibold sm:block\",\"children\":\"Ray's Blog\"}]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4 leading-5 sm:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"no-scrollbar hidden max-w-40 items-center space-x-4 overflow-x-auto pr-2 sm:flex sm:space-x-6 md:max-w-72 lg:max-w-96\",\"children\":[[\"$\",\"$L5\",\"Blog\",{\"className\":\"m-1 block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400\",\"href\":\"/blog\",\"children\":\"Blog\"}],[\"$\",\"$L5\",\"Tags\",{\"className\":\"m-1 block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400\",\"href\":\"/tags\",\"children\":\"Tags\"}],[\"$\",\"$L5\",\"Projects\",{\"className\":\"m-1 block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400\",\"href\":\"/projects\",\"children\":\"Projects\"}],[\"$\",\"$L5\",\"About\",{\"className\":\"m-1 block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400\",\"href\":\"/about\",\"children\":\"About\"}]]}],[\"$\",\"$L6\",null,{\"aria-label\":\"Search\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"fill\":\"none\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":1.5,\"stroke\":\"currentColor\",\"className\":\"h-6 w-6 text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"d\":\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"}]}]}],[\"$\",\"$L7\",null,{}],[\"$\",\"$L8\",null,{\"headerNavLinks\":[{\"href\":\"/\",\"title\":\"Home\"},{\"href\":\"/blog\",\"title\":\"Blog\"},{\"href\":\"/tags\",\"title\":\"Tags\"},{\"href\":\"/projects\",\"title\":\"Projects\"},{\"href\":\"/about\",\"title\":\"About\"}]}]]}]]}],[\"$\",\"main\",null,{\"className\":\"mb-auto\",\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pb-8 pt-6 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl font-bold leading-normal md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$L5\",null,{\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500\",\"href\":\"/\",\"children\":\"Back to homepage\"}]]}]]}]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mt-16 flex flex-col items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-3 flex space-x-4\",\"children\":[null,[\"$\",\"a\",null,{\"href\":\"mailto:chanchiwairay@gmail.com\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"mail\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 20 20\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-8 w-8\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Mail\"}],[\"$\",\"path\",null,{\"d\":\"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z\"}],[\"$\",\"path\",null,{\"d\":\"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z\"}]]}]]}],[\"$\",\"a\",null,{\"href\":\"https://github.com/chanchiwai-ray\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"github\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-8 w-8\",\"children\":[[\"$\",\"title\",null,{\"children\":\"GitHub\"}],[\"$\",\"path\",null,{\"d\":\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"}]]}]]}],[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/chi-wai-chan-ba5870137\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"linkedin\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-8 w-8\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Linkedin\"}],[\"$\",\"path\",null,{\"d\":\"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z\"}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"div\",null,{\"children\":\"Chi Wai CHAN\"}],[\"$\",\"div\",null,{\"children\":\" ‚Ä¢ \"}],[\"$\",\"div\",null,{\"children\":\"¬© 2025\"}],[\"$\",\"div\",null,{\"children\":\" ‚Ä¢ \"}],[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/chanchiwai-ray/chanchiwai-ray.github.io/issues\",\"children\":\"Report Issues\"}]]}]]}]}]]}]]}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"k8s/deploy-charmed-kubernetes\",\"c\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$Lb\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/10e892855c0ee316.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"mPmMI8GPly3IZvq4r1b5D\",{\"children\":[[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[\"$\",\"$L10\",null,{\"children\":\"$L11\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$12\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"13:I[1674,[\"173\",\"static/chunks/173-cdf34a84fb71192b.js\",\"970\",\"static/chunks/970-9f18edc3a6e123c8.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-9b88551e61e607f4.js\"],\"default\"]\n14:I[7970,[\"173\",\"static/chunks/173-cdf34a84fb71192b.js\",\"970\",\"static/chunks/970-9f18edc3a6e123c8.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-9b88551e61e607f4.js\"],\"Image\"]\n15:I[8801,[\"173\",\"static/chunks/173-cdf34a84fb71192b.js\",\"970\",\"static/chunks/970-9f18edc3a6e123c8.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-9b88551e61e607f4.js\"],\"default\"]\n16:I[4136,[\"173\",\"static/chunks/173-cdf34a84fb71192b.js\",\"970\",\"static/chunks/970-9f18edc3a6e123c8.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-9b88551e61e607f4.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"Setting Up Kubernetes Cluster with Canonical Kubernetes\\\",\\\"datePublished\\\":\\\"2025-03-30T00:00:00.000Z\\\",\\\"dateModified\\\":\\\"2025-03-30T00:00:00.000Z\\\",\\\"description\\\":\\\"There many ways to set up Kubernetes cluster for learning purpose, such as minikube or MicroK8s. In this post, I would like to introduce yet another way to deploy Kubernetes cluster with Canoincal K8s.\\\",\\\"image\\\":\\\"/static/images/x-card.png\\\",\\\"url\\\":\\\"https://chanchiwai-ray.github.io/blog/k8s/deploy-charmed-kubernetes\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Chi Wai CHAN\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L13\",null,{\"provider\":\"giscus\"}],[\"$\",\"article\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700\",\"children\":[[\"$\",\"header\",null,{\"className\":\"pt-6 xl:pb-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"space-y-1 text-center\",\"children\":[[\"$\",\"dl\",null,{\"className\":\"space-y-10\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Published on\"}],[\"$\",\"dd\",null,{\"className\":\"text-base font-medium leading-6 text-gray-500 dark:text-gray-400\",\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2025-03-30T00:00:00.000Z\",\"children\":\"Sunday, March 30, 2025\"}]}]]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14\",\"children\":\"Setting Up Kubernetes Cluster with Canonical Kubernetes\"}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0\",\"children\":[[\"$\",\"dl\",null,{\"className\":\"pb-10 pt-6 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700\",\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Authors\"}],[\"$\",\"dd\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8\",\"children\":[[\"$\",\"li\",\"Chi Wai CHAN\",{\"className\":\"flex items-center space-x-2\",\"children\":[[\"$\",\"$L14\",null,{\"src\":\"/static/images/avatar.png\",\"width\":38,\"height\":38,\"alt\":\"avatar\",\"className\":\"h-10 w-10 rounded-full\"}],[\"$\",\"dl\",null,{\"className\":\"whitespace-nowrap text-sm font-medium leading-5\",\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Name\"}],[\"$\",\"dd\",null,{\"className\":\"text-gray-900 dark:text-gray-100\",\"children\":\"Chi Wai CHAN\"}],[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Linkedin and GitHub\"}],[\"$\",\"dd\",null,{\"children\":[[\"$\",\"a\",null,{\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.linkedin.com/in/chi-wai-chan-ba5870137\",\"children\":\"@Linkedin\"}],\" ‚Ä¢ \",[\"$\",\"a\",null,{\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/chanchiwai-ray\",\"children\":\"@Github\"}]]}]]}]]}]]}]}]]}],[\"$\",\"div\",null,{\"className\":\"divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"prose max-w-none pb-8 pt-10 dark:prose-invert\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"-introduction\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#-introduction\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"viewBox\":\"0 0 20 20\",\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"üåü Introduction\"]}],[\"$\",\"p\",null,{\"children\":[\"Distributions like minikube and MicroK8s are great for setting up a local Kubernetes for testing and learning. If you need anything more than a testing environment (maybe a cluster for your homelab or a cluster for your small business), these option may not be great. \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://ubuntu.com/kubernetes\",\"children\":\"Canonical Kubernetes\"}],\" is another distribution which can be used to deploy multi-node Kubernetes cluster on premise or on the cloud, and it offers many \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://documentation.ubuntu.com/canonical-kubernetes/latest/charm/howto/#how-to-guides\",\"children\":\"integrations\"}],\" with other solutions such as OpenStack and Ceph.\"]}],[\"$\",\"p\",null,{\"children\":[\"In this post, I am going to show you how to set up a three nodes Kubernetes cluster on you local desktop or laptop for \",[\"$\",\"strong\",null,{\"children\":\"testing or learning\"}],\" purpose. The tutorial uses \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://documentation.ubuntu.com/lxd/en/latest/\",\"children\":\"LXD\"}],\" as the cloud substrate for the nodes, but you can also use other \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://documentation.ubuntu.com/juju/latest/user/reference/cloud/\",\"children\":\"cloud substrates\"}],\" as well.\"]}],[\"$\",\"div\",null,{\"className\":\"markdown-alert markdown-alert-warning\",\"dir\":\"auto\",\"children\":[[\"$\",\"p\",null,{\"className\":\"markdown-alert-title\",\"dir\":\"auto\",\"children\":[[\"$\",\"svg\",null,{\"viewBox\":\"0 0 16 16\",\"aria-hidden\":\"true\",\"className\":\"octicon\",\"height\":\"16\",\"width\":\"16\",\"children\":[\"$\",\"path\",null,{\"d\":\"M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z\"}]}],\"WARNING\"]}],[\"$\",\"p\",null,{\"children\":\"Do not use it for production! This is not a tutorial for setting up a production grade Kubernetes cluster!\"}]]}],[\"$\",\"ul\",null,{\"className\":\"\",\"children\":[[\"$\",\"li\",\"0\",{\"className\":\"\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#-introduction\",\"children\":\"üåü Introduction\"}],null]}],[\"$\",\"li\",\"1\",{\"className\":\"\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#-prerequisite\",\"children\":\"ü™® Prerequisite\"}],null]}],[\"$\",\"li\",\"2\",{\"className\":\"\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#-getting-started\",\"children\":\"üöÄ Getting Started\"}],[\"$\",\"ul\",null,{\"className\":\"\",\"children\":[[\"$\",\"li\",\"0\",{\"className\":\"\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#-terraform-plan\",\"children\":\"üìë Terraform plan\"}],null]}],[\"$\",\"li\",\"1\",{\"className\":\"\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#-put-it-all-together\",\"children\":\"ü§ù Put it all together\"}],null]}],[\"$\",\"li\",\"2\",{\"className\":\"\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#-deploy-kubernetes-cluster\",\"children\":\"üíª Deploy Kubernetes cluster\"}],null]}],[\"$\",\"li\",\"3\",{\"className\":\"\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#-manage-the-kubernetes-cluster\",\"children\":\"üßô Manage the Kubernetes cluster\"}],null]}],[\"$\",\"li\",\"4\",{\"className\":\"\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#-check-the-status-of-kubernetes-cluster\",\"children\":\"üí° Check the status of Kubernetes cluster\"}],null]}]]}]]}],[\"$\",\"li\",\"3\",{\"className\":\"\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#-clean-up-resources\",\"children\":\"üßπ Clean up resources\"}],null]}]]}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"-prerequisite\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#-prerequisite\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"viewBox\":\"0 0 20 20\",\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"ü™® Prerequisite\"]}],[\"$\",\"p\",null,{\"children\":\"Before you continue with the tutorial, please make sure that you have met the following software or hardware requirements. You can follow the link to install and initialize the software required for this tutorial.\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://documentation.ubuntu.com/lxd/en/latest/\",\"children\":\"LXD\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://juju.is/\",\"children\":\"Juju\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.terraform.io/\",\"children\":\"Terraform\"}]}],[\"$\",\"li\",null,{\"children\":\"About 6 CPUs (not a strict requirements)\"}],[\"$\",\"li\",null,{\"children\":\"About 12 GiB of RAMs (not a strict requirements)\"}],[\"$\",\"li\",null,{\"children\":\"About 100 GiB of storage (not a strict requirements)\"}]]}],[\"$\",\"p\",null,{\"children\":\"These are not a hard requirements. Depending on the workloads, you should still be able to complete the deployment with a less powerful machine.\"}],[\"$\",\"div\",null,{\"className\":\"markdown-alert markdown-alert-note\",\"dir\":\"auto\",\"children\":[[\"$\",\"p\",null,{\"className\":\"markdown-alert-title\",\"dir\":\"auto\",\"children\":[[\"$\",\"svg\",null,{\"viewBox\":\"0 0 16 16\",\"aria-hidden\":\"true\",\"className\":\"octicon\",\"height\":\"16\",\"width\":\"16\",\"children\":[\"$\",\"path\",null,{\"d\":\"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z\"}]}],\"NOTE\"]}],[\"$\",\"p\",null,{\"children\":\"The reason for using Juju and Terraform is for reproducibility. As a testing environment, you may change you setup frequently. Using terraform allows you to easily re-deploy the same environment with all the necessary addons.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"-getting-started\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#-getting-started\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"viewBox\":\"0 0 20 20\",\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"üöÄ Getting Started\"]}],[\"$\",\"div\",null,{\"className\":\"markdown-alert markdown-alert-tip\",\"dir\":\"auto\",\"children\":[[\"$\",\"p\",null,{\"className\":\"markdown-alert-title\",\"dir\":\"auto\",\"children\":[[\"$\",\"svg\",null,{\"viewBox\":\"0 0 16 16\",\"aria-hidden\":\"true\",\"className\":\"octicon\",\"height\":\"16\",\"width\":\"16\",\"children\":[\"$\",\"path\",null,{\"d\":\"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z\"}]}],\"TIP\"]}],[\"$\",\"p\",null,{\"children\":[\"If you simply want to try out the Kubernetes cluster, you can go to my infrastructure repository: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/chanchiwai-ray/infrastructure/tree/main/deployments/testing-ha/k8s-juju-lxd\",\"children\":\"https://github.com/chanchiwai-ray/infrastructure/tree/main/deployments/testing-ha/k8s-juju-lxd\"}],\".\"]}]]}],[\"$\",\"p\",null,{\"children\":[\"We will be using the \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://registry.terraform.io/providers/juju/juju/latest/docs\",\"children\":\"Terraform Juju provider\"}],\" to deploy three nodes Kubernetes cluster at version 1.32. One of the served as both worker and control plane node, the remaining two will be the worker nodes. The spec of virtual machines are listed below:\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"k8s/0\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"2 vCPUs\"}],[\"$\",\"li\",null,{\"children\":\"4 GiB of RAMs\"}],[\"$\",\"li\",null,{\"children\":\"1 root disk of 20 GiB\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[\"k8s-worker/0\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"2 vCPUs\"}],[\"$\",\"li\",null,{\"children\":\"4 GiB of RAMs\"}],[\"$\",\"li\",null,{\"children\":\"1 root disk of 40 GiB\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[\"k8s-worker/1\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"2 vCPUs\"}],[\"$\",\"li\",null,{\"children\":\"4 GiB of RAMs\"}],[\"$\",\"li\",null,{\"children\":\"1 root disk of 40 GiB\"}]]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"-terraform-plan\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#-terraform-plan\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"viewBox\":\"0 0 20 20\",\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"üìë Terraform plan\"]}],[\"$\",\"p\",null,{\"children\":[\"The first thing in the terraform plan is the \",[\"$\",\"code\",null,{\"children\":\"terraform\"}],\" block. We will specify the provider as Terraform Juju provider. Then, we need to create a \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://documentation.ubuntu.com/juju/latest/user/reference/model/\",\"children\":\"Juju model\"}],\" called \",[\"$\",\"code\",null,{\"children\":\"k8s\"}],\" on the cloud \",[\"$\",\"code\",null,{\"children\":\"localhost\"}],\" in \",[\"$\",\"code\",null,{\"children\":\"localhost\"}],\" region.\"]}],[\"$\",\"$L15\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-terraform\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# main.tf\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# Use Terraform Juju provider\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"terraform {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  required_providers {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    juju = {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"      version = \\\"~\u003e 0.17.0\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"      source  = \\\"juju/juju\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"}\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# Create a Juju model\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"resource \\\"juju_model\\\" \\\"k8s_model\\\" {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  name = \\\"k8s\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  # In my case, they are both `localhost`.\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  # You can check yours using `juju clouds` and `juju regions`.\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  cloud {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    name   = \\\"localhost\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    region = \\\"localhost\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"}\\n\"}]]}]}],[\"$\",\"hr\",null,{}],[\"$\",\"p\",null,{\"children\":[\"Next, we will create one unit of the control plane node (also used as a worker, but you disabled it using \",[\"$\",\"code\",null,{\"children\":\"kubectl\"}],\" later if required).\"]}],[\"$\",\"$L15\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-terraform\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# main.tf\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# ... some content from previous steps\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"module \\\"k8s\\\" {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  source = \\\"git::https://github.com/canonical/k8s-operator//charms/worker/k8s/terraform?ref=main\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  units = 1 # one control plane node\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  model = juju_model.k8s_model.name\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  base        = \\\"ubuntu@24.04\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  channel     = \\\"1.32/stable\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  constraints = \\\"arch=amd64 cores=2 mem=4096M root-disk=20480M virt-type=virtual-machine\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  config = {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    load-balancer-enabled = true                        # enable load balancer feature\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    load-balancer-cidrs   = \\\"10.42.75.200-10.42.75.200\\\" # load balancer cidrs (placeholder, need update)\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    ingress-enabled       = true                        # enable ingress feature\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    local-storage-enabled = true                        # enable local hostpath storage\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"}\\n\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Here, I am using a module from the upstream to simplify the terraform plan a little bit. For the module options, I set the version of Kubernetes to \",[\"$\",\"code\",null,{\"children\":\"1.32\"}],\" and specify the constraints for the unit as \",[\"$\",\"code\",null,{\"children\":\"arch=amd64 cores=2 mem=4096M root-disk=20480M virt-type=virtual-machine\"}],\". If you want to use a different version of Kubernetes, or want to use less resources, you can adjust those values. However, note that the constraint for \",[\"$\",\"code\",null,{\"children\":\"virt-type=virtual-machine\"}],\" is \",[\"$\",\"strong\",null,{\"children\":\"required\"}],\", since the CNI used in Canonical Kubernetes (Cilium) cannot run inside unprivileged containers.\"]}],[\"$\",\"p\",null,{\"children\":[\"If you are deploying a Kubernetes cluster for learning, it's general nice to have some built-in features such ingress controller and storage class configured. So, in the \",[\"$\",\"code\",null,{\"children\":\"config\"}],\" block, I enable the load-balancer, ingress, and local storage features.\"]}],[\"$\",\"hr\",null,{}],[\"$\",\"p\",null,{\"children\":\"Next, we will add two units of the worker nodes.\"}],[\"$\",\"$L15\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-terraform\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# main.tf\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# ... some content from previous steps\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"module \\\"k8s_worker\\\" {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  source = \\\"git::https://github.com/canonical/k8s-operator//charms/worker/terraform?ref=main\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  units = 2 # two worker nodes\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  model = juju_model.k8s_model.name\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  base        = \\\"ubuntu@24.04\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  channel     = \\\"1.32/stable\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  constraints = \\\"arch=amd64 cores=2 mem=4096M root-disk=40960M virt-type=virtual-machine\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  config = {}\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"}\\n\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Here, the module options are pretty much the same as the control plane node, just a bit more storage \",[\"$\",\"code\",null,{\"children\":\"root-disk=40960M\"}],\" and no extra configuration for the worker nodes.\"]}],[\"$\",\"hr\",null,{}],[\"$\",\"p\",null,{\"children\":[\"Finally, the control plane node and the worker nodes need to form a cluster. To do that, we can use the \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://documentation.ubuntu.com/juju/latest/user/reference/relation/\",\"children\":\"Juju integration\"}],\", and it's a resource in Terraform Juju provider.\"]}],[\"$\",\"$L15\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-terraform\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# main.tf\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# ... some content from previous steps\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"resource \\\"juju_integration\\\" \\\"k8s_to_k8s_worker\\\" {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  model = juju_model.k8s_model.name\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  application {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    name     = module.k8s.app_name\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    endpoint = \\\"k8s-cluster\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  application {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    name     = module.k8s_worker.app_name\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    endpoint = \\\"cluster\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"}\\n\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"The Juju integration basically are some Python codes that handles the forming (or destruction) of Kubernetes cluster.\"}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"-put-it-all-together\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#-put-it-all-together\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"viewBox\":\"0 0 20 20\",\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"ü§ù Put it all together\"]}],[\"$\",\"p\",null,{\"children\":\"Below is the entire terraform plan for deploying three nodes Kubernetes cluster:\"}],[\"$\",\"$L15\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-terraform\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# main.tf\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# Use Terraform Juju provider\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"terraform {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  required_providers {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    juju = {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"      version = \\\"~\u003e 0.17.0\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"      source  = \\\"juju/juju\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"}\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"# Create a Juju model\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"resource \\\"juju_model\\\" \\\"k8s_model\\\" {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  name = \\\"k8s\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  # In my case, they are both `localhost`.\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  # You can check yours using `juju clouds` and `juju regions`.\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  cloud {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    name   = \\\"localhost\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    region = \\\"localhost\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"}\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"module \\\"k8s\\\" {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  source = \\\"git::https://github.com/canonical/k8s-operator//charms/worker/k8s/terraform?ref=main\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  units = 1 # one control plane node\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  model = juju_model.k8s_model.name\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  base        = \\\"ubuntu@24.04\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  channel     = \\\"1.32/stable\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  constraints = \\\"arch=amd64 cores=2 mem=4096M root-disk=20480M virt-type=virtual-machine\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  config = {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    load-balancer-enabled = true                        # enable load balancer feature\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    load-balancer-cidrs   = \\\"10.42.75.200-10.42.75.200\\\" # load balancer cidrs (placeholder, need update)\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    ingress-enabled       = true                        # enable ingress feature\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    local-storage-enabled = true                        # enable local hostpath storage\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"}\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"module \\\"k8s_worker\\\" {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  source = \\\"git::https://github.com/canonical/k8s-operator//charms/worker/terraform?ref=main\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  units = 2 # two worker nodes\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  model = juju_model.k8s_model.name\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  base        = \\\"ubuntu@24.04\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  channel     = \\\"1.32/stable\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  constraints = \\\"arch=amd64 cores=2 mem=4096M root-disk=40960M virt-type=virtual-machine\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  config = {}\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"}\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"resource \\\"juju_integration\\\" \\\"k8s_to_k8s_worker\\\" {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  model = juju_model.k8s_model.name\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  application {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    name     = module.k8s.app_name\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    endpoint = \\\"k8s-cluster\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  application {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    name     = module.k8s_worker.app_name\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    endpoint = \\\"cluster\\\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  }\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"}\\n\"}]]}]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"-deploy-kubernetes-cluster\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#-deploy-kubernetes-cluster\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"viewBox\":\"0 0 20 20\",\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"üíª Deploy Kubernetes cluster\"]}],[\"$\",\"p\",null,{\"children\":\"In the directory with the terraform plan, and run the following commands:\"}],[\"$\",\"$L15\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"terraform init\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"terraform plan\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"terraform apply\\n\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"This will deploy the kubernetes cluster in the background. To monitor the deployment progress, run\"}],[\"$\",\"$L15\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"juju status \",[\"$\",\"span\",null,{\"className\":\"token variable parameter\",\"children\":\"--watch\"}],\" 5s\\n\"]}]}]}],[\"$\",\"p\",null,{\"children\":\"When the deployment is completed, you should see something like this\"}],[\"$\",\"$L15\",null,{\"className\":\"language-text\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-text\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Model  Controller  Cloud/Region         Version  SLA          Timestamp\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"k8s    overlord    localhost/localhost  3.6.3    unsupported  14:35:30+08:00\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"App         Version  Status  Scale  Charm       Channel      Rev  Exposed  Message\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"k8s         1.32.2   active      1  k8s         1.32/stable  458  yes      Ready\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"k8s-worker  1.32.2   active      2  k8s-worker  1.32/stable  456  no       Ready\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Unit           Workload  Agent  Machine  Public address  Ports     Message\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"k8s-worker/0*  active    idle   0        10.42.75.176              Ready\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"k8s-worker/1   active    idle   1        10.42.75.227              Ready\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"k8s/0*         active    idle   2        10.42.75.196    6443/tcp  Ready\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Machine  State    Address       Inst id        Base          AZ  Message\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"0        started  10.42.75.176  juju-da35cc-0  ubuntu@24.04      Running\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"1        started  10.42.75.227  juju-da35cc-1  ubuntu@24.04      Running\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"2        started  10.42.75.196  juju-da35cc-2  ubuntu@24.04      Running\\n\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"I mentioned earlier that the \",[\"$\",\"code\",null,{\"children\":\"load-balancer-cidrs\"}],\" config option was just a placeholder. Now, we will update it the IP addresses of these nodes (because we don't have external load balancer so we will just use these nodes as \\\"external\\\" load balancer).\"]}],[\"$\",\"$L15\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"juju config k8s load-balancer-cidrs\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"10.42.75.176/32 10.42.75.227/32 10.42.75.196/32\\\"\"}],\"\\n\"]}]}]}],[\"$\",\"p\",null,{\"children\":[\"One of the IP will be used by Cilium to create a \",[\"$\",\"code\",null,{\"children\":\"cilium-ingress\"}],\" service of \",[\"$\",\"code\",null,{\"children\":\"LoadBalancer\"}],\" type (remember we enabled ingress feature), so you will only have two IPs for service of \",[\"$\",\"code\",null,{\"children\":\"LoadBalancer\"}],\" type.\"]}],[\"$\",\"p\",null,{\"children\":[\"For more information about ingress and load balancer in Canonical Kubernetes, see the \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://documentation.ubuntu.com/canonical-kubernetes/latest/charm/explanation/\",\"children\":\"documentation\"}],\".\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"-manage-the-kubernetes-cluster\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#-manage-the-kubernetes-cluster\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"viewBox\":\"0 0 20 20\",\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"üßô Manage the Kubernetes cluster\"]}],[\"$\",\"p\",null,{\"children\":\"To retrieve the kube config, run\"}],[\"$\",\"$L15\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"mkdir\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token variable parameter\",\"children\":\"-p\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant environment\",\"children\":\"$$HOME\"}],\"/.kube/config\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token variable parameter\",\"children\":\"-e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant environment\",\"children\":\"$$HOME\"}],\"/.kube/config \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"then\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"mv\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant environment\",\"children\":\"$$HOME\"}],\"/.kube/config \",[\"$\",\"span\",null,{\"className\":\"token constant environment\",\"children\":\"$$HOME\"}],\"/.kube/config.backup.\",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"$$(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"date\"}],\" +%F\",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\")\"}]]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fi\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"juju run k8s/0 get-kubeconfig \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\" yq \",[\"$\",\"span\",null,{\"className\":\"token variable parameter\",\"children\":\"-r\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'.kubeconfig'\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant environment\",\"children\":\"$$HOME\"}],\"/.kube/config\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\". The \",[\"$\",\"code\",null,{\"children\":\"get-kubeconfig\"}],\" is an \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://documentation.ubuntu.com/juju/latest/user/reference/action/\",\"children\":\"Juju action\"}],\" defined in the k8s operator that returns the kube config in yaml format. We need to extract the \",[\"$\",\"code\",null,{\"children\":\"kubeconfig\"}],\" key from the result, and place it in \",[\"$\",\"code\",null,{\"children\":\"$$HOME/.kube/config\"}],\". In case you previously have the kube config, you can also back it up \",[\"$\",\"code\",null,{\"children\":\"mv $HOME/.kube/config $HOME/.kube/config.backup.$(date +%F)\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":[\"You can then use \",[\"$\",\"code\",null,{\"children\":\"kubectl\"}],\" to manage the Kubernetes cluster. If you are on Ubuntu, you can use the \",[\"$\",\"code\",null,{\"children\":\"kubectl\"}],\" snap.\"]}],[\"$\",\"$L15\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"sudo\"}],\" snap \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"install\"}],\" kubectl \",[\"$\",\"span\",null,{\"className\":\"token variable parameter\",\"children\":\"--classic\"}],\"\\n\"]}]}]}],[\"$\",\"p\",null,{\"children\":[\"Alternatively, you can install \",[\"$\",\"code\",null,{\"children\":\"kubectl\"}],\" following the \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://kubernetes.io/docs/tasks/tools/\",\"children\":\"official documentation\"}],\".\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"-check-the-status-of-kubernetes-cluster\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#-check-the-status-of-kubernetes-cluster\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"viewBox\":\"0 0 20 20\",\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"üí° Check the status of Kubernetes cluster\"]}],[\"$\",\"p\",null,{\"children\":\"Finally, let's check what is in the Kubernetes cluster.\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Nodes\"}]}],[\"$\",\"$L15\",null,{\"className\":\"language-text\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-text\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"$$ kubectl get nodes\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"NAME            STATUS   ROLES                  AGE   VERSION\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"juju-da35cc-0   Ready    worker                 36m   v1.32.2\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"juju-da35cc-1   Ready    worker                 35m   v1.32.2\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"juju-da35cc-2   Ready    control-plane,worker   36m   v1.32.2\\n\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Kube System\"}]}],[\"$\",\"$L15\",null,{\"className\":\"language-text\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-text\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"$$ kubectl get -n kube-system all\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"NAME                                      READY   STATUS    RESTARTS      AGE\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"pod/cilium-58b8b                          1/1     Running   0             3h54m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"pod/cilium-d77pw                          1/1     Running   0             123m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"pod/cilium-gvs2f                          1/1     Running   0             123m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"pod/cilium-operator-85f5f9954b-82n7g      1/1     Running   1 (18m ago)   123m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"pod/ck-storage-rawfile-csi-controller-0   2/2     Running   0             3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"pod/ck-storage-rawfile-csi-node-lptc2     4/4     Running   0             3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"pod/ck-storage-rawfile-csi-node-rhshh     4/4     Running   0             3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"pod/ck-storage-rawfile-csi-node-sf5b7     4/4     Running   0             3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"pod/coredns-56d5ddcf86-lklvw              1/1     Running   0             3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"pod/metrics-server-8694c96fb7-87fbm       1/1     Running   0             3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"NAME                                        TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)                      AGE\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"service/cilium-ingress                      LoadBalancer   10.152.183.250   10.42.75.176   80:30953/TCP,443:30265/TCP   123m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"service/ck-storage-rawfile-csi-controller   ClusterIP      None             \u003cnone\u003e         \u003cnone\u003e                       3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"service/ck-storage-rawfile-csi-node         ClusterIP      10.152.183.254   \u003cnone\u003e         9100/TCP                     3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"service/coredns                             ClusterIP      10.152.183.177   \u003cnone\u003e         53/UDP,53/TCP                3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"service/hubble-peer                         ClusterIP      10.152.183.193   \u003cnone\u003e         443/TCP                      3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"service/metrics-server                      ClusterIP      10.152.183.219   \u003cnone\u003e         443/TCP                      3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"NAME                                         DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"daemonset.apps/cilium                        3         3         3       3            3           kubernetes.io/os=linux   3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"daemonset.apps/ck-storage-rawfile-csi-node   3         3         3       3            3           \u003cnone\u003e                   3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"NAME                              READY   UP-TO-DATE   AVAILABLE   AGE\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"deployment.apps/cilium-operator   1/1     1            1           3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"deployment.apps/coredns           1/1     1            1           3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"deployment.apps/metrics-server    1/1     1            1           3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"NAME                                         DESIRED   CURRENT   READY   AGE\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"replicaset.apps/cilium-operator-6978488575   0         0         0       3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"replicaset.apps/cilium-operator-7c47596f76   0         0         0       3h54m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"replicaset.apps/cilium-operator-85f5f9954b   1         1         1       123m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"replicaset.apps/cilium-operator-85fb4b9ddf   0         0         0       3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"replicaset.apps/coredns-56d5ddcf86           1         1         1       3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"replicaset.apps/metrics-server-8694c96fb7    1         1         1       3h55m\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"NAME                                                 READY   AGE\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"statefulset.apps/ck-storage-rawfile-csi-controller   1/1     3h55m\\n\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"There are ingress, local rawfile storage, and load balancer features because we enabled them during the deploymentbecause we enabled them during the deployment.\"}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"-clean-up-resources\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#-clean-up-resources\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"viewBox\":\"0 0 20 20\",\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"üßπ Clean up resources\"]}],[\"$\",\"p\",null,{\"children\":\"When you are done with the testing, run\"}],[\"$\",\"$L15\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"terraform apply \",[\"$\",\"span\",null,{\"className\":\"token variable parameter\",\"children\":\"-destroy\"}],\"\\n\"]}]}]}],[\"$\",\"p\",null,{\"children\":\"to clean up the resources.\"}],[\"$\",\"hr\",null,{}],[\"$\",\"p\",null,{\"children\":\"üöÄ That's all for now! Hope you enjoy learning Kubernetes!\"}]]}],[\"$\",\"div\",null,{\"className\":\"pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300\",\"children\":[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/chanchiwai-ray/chanchiwai-ray.github.io/blob/main/data/blog/k8s/deploy-charmed-kubernetes.mdx\",\"children\":\"View on GitHub\"}]}],[\"$\",\"div\",null,{\"className\":\"pb-6 pt-6 text-center text-gray-700 dark:text-gray-300\",\"id\":\"comment\",\"children\":[\"$\",\"$L16\",null,{\"slug\":\"k8s/deploy-charmed-kubernetes\",\"comments\":{\"provider\":\"giscus\",\"giscusConfig\":{\"repo\":\"$undefined\",\"repositoryId\":\"$undefined\",\"category\":\"$undefined\",\"categoryId\":\"$undefined\",\"mapping\":\"pathname\",\"reactions\":\"1\",\"metadata\":\"0\",\"theme\":\"light\",\"darkTheme\":\"transparent_dark\",\"themeURL\":\"\",\"lang\":\"en\"}}}]}]]}],[\"$\",\"footer\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y\",\"children\":[[\"$\",\"div\",null,{\"className\":\"py-4 xl:py-8\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400\",\"children\":\"Tags\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap\",\"children\":[[\"$\",\"$L5\",\"kubernetes\",{\"href\":\"/tags/kubernetes\",\"className\":\"mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"children\":\"kubernetes\"}],[\"$\",\"$L5\",\"juju\",{\"href\":\"/tags/juju\",\"className\":\"mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"children\":\"juju\"}],[\"$\",\"$L5\",\"lxd\",{\"href\":\"/tags/lxd\",\"className\":\"mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"children\":\"lxd\"}],[\"$\",\"$L5\",\"terraform\",{\"href\":\"/tags/terraform\",\"className\":\"mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"children\":\"terraform\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"flex justify-between py-4 xl:block xl:space-y-8 xl:py-8\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400\",\"children\":\"Previous Article\"}],[\"$\",\"div\",null,{\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"children\":[\"$\",\"$L5\",null,{\"className\":\"break-words\",\"href\":\"/blog/ceph/deploy-three-nodes-microceph\",\"children\":\"Setting Up Ceph Cluster with MicroCeph\"}]}]]}],\"$undefined\"]}]]}],[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$L5\",null,{\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/blog\",\"aria-label\":\"Back to the blog\",\"children\":\"‚Üê Back to the blog\"}]}]]}]]}]]}]}]]}]]\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Setting Up Kubernetes Cluster with Canonical Kubernetes | Ray's Blog\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"There many ways to set up Kubernetes cluster for learning purpose, such as minikube or MicroK8s. In this post, I would like to introduce yet another way to deploy Kubernetes cluster with Canoincal K8s.\"}],[\"$\",\"meta\",\"3\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"4\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"5\",{\"rel\":\"canonical\",\"href\":\"https://chanchiwai-ray.github.io/blog/k8s/deploy-charmed-kubernetes\"}],[\"$\",\"link\",\"6\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://chanchiwai-ray.github.io/feed.xml\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:title\",\"content\":\"Setting Up Kubernetes Cluster with Canonical Kubernetes\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:description\",\"content\":\"There many ways to set up Kubernetes cluster for learning purpose, such as minikube or MicroK8s. In this post, I would like to introduce yet another way to deploy Kubernetes cluster with Canoincal K8s.\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:url\",\"content\":\"https://chanchiwai-ray.github.io/blog/k8s/deploy-charmed-kubernetes\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:site_name\",\"content\":\"Ray's Blog\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:image\",\"content\":\"https://chanchiwai-ray.github.io/static/images/x-card.png\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"14\",{\"property\":\"article:published_time\",\"content\":\"2025-03-30T00:00:00.000Z\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:modified_time\",\"content\":\"2025-03-30T00:00:00.000Z\"}],[\"$\",\"meta\",\"16\",{\"property\":\"article:author\",\"content\":\"Chi Wai CHAN\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:title\",\"content\":\"Setting Up Kubernetes Cluster with Canonical Kubernetes\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:description\",\"content\":\"There many ways to set up Kubernetes cluster for learning purpose, such as minikube or MicroK8s. In this post, I would like to introduce yet another way to deploy Kubernetes cluster with Canoincal K8s.\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:image\",\"content\":\"https://chanchiwai-ray.github.io/static/images/x-card.png\"}]]\n"])</script><script>self.__next_f.push([1,"d:null\n"])</script></body></html>